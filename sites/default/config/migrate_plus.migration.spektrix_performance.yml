uuid: 37ceb9d8-4535-4554-9908-f24da74048cd
langcode: en
status: true
dependencies:
  module:
    - spektrix_import
  enforced:
    module:
      - migrate_plus
      - spektrix_import
id: spektrix_performance
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: spektrix
label: 'Performance migration'
source:
  plugin: spektrix_performance
  data_fetcher_plugin: http
  data_parser_plugin: spektrix_xml
  urls: 'https://system.spektrix.com/queenshalledinburgh/api/v1/eventsrestful.svc/allattributes/next?n=1000'
  item_selector: /Events/Event/Times/EventTime
  fields:
    -
      name: EventInstanceId
      label: 'Performance ID'
      selector: EventInstanceId
    -
      name: Time
      label: 'Performance date'
      selector: Time
    -
      name: SeatsAvailable
      label: 'Seat availability'
      selector: SeatsAvailable
    -
      name: SeatsAvailable
      label: 'Seat availability'
      selector: SeatsAvailable
    -
      name: OnSaleOnWeb
      label: 'On sale'
      selector: OnSaleOnWeb
    -
      name: Capacity
      label: Capacity
      selector: Capacity
    -
      name: SeatsLocked
      label: SeatsLocked
      selector: SeatsLocked
    -
      name: Attributes
      label: 'Door Open Times'
      selector: Attributes
    -
      name: doTime
      label: 'Pseudo element for Door Open Times'
    -
      name: Event
      label: 'Parent XML element'
      selector: ../../Id
  ids:
    EventInstanceId:
      type: int
process:
  field_perf_date:
    plugin: format_date
    from_format: 'Y-m-d\TH:i:s'
    to_format: 'Y-m-d\TH:i:s'
    from_timezone: Europe/London
    to_timezone: UTC
    source: Time
  field_do_time: doTime
  field_spektrix_perf_id: EventInstanceId
  field_event:
    plugin: migration
    migration: spektrix_event
    source: Event
  title: EventInstanceId
  field_onsale: OnSaleOnWeb
  field_availability_percentage:
    plugin: availability_percentage
    source: SeatsAvailable
  field_availability:
    plugin: spektrix_availability
    source: SeatsAvailable
  field_accessibility:
    plugin: spektrix_accessibility
    source: Attributes
destination:
  plugin: 'entity:performances'
  default_bundle: performance
migration_dependencies:
  optional:
    - spektrix_event
